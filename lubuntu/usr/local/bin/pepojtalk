#!/bin/bash
# The MIT License
# Copyright (c) 2022-2028 Isamu.Yamauchi , 2022.8.22 update 2022.8.26
# install open-jtalk ,dic ,hts-voice
# sudo apt install open-jtalk open-jtalk-mecab-naist-jdic hts-voice-nitech-jp-atr503-m001
# wget https://sourceforge.net/projects/mmdagent/files/MMDAgent_Example/MMDAgent_Example-1.8/MMDAgent_Example-1.8.zip
# unzip MMDAgent_Example-1.8.zip
# mv MMDAgent_Example-1.8/Voice/mei /usr/share/hts-voice/
# pepojtak; speaks air conditions that Alexa cannot.

PATH=$PATH:/usr/local/bin:/usr/local/sbin
OPENJTALK=/usr/bin/open_jtalk
DIR=/www/remote-hand/tmp
CMD=$DIR/pepoltalk.pepocmd
VOICEREQ=$DIR/.voice_req.tmp
VOICE_PITCH=0.7
INTERVAL=5
[ ! -e $VOICEREQ ] && exit
tVOICEREQ=`cat $VOICEREQ`
if [ $tVOICEREQ != "none" ];then
  NOWSECOND=`date +%s`
  VOICEREQ_STAMP=`date +%s -r $VOICEREQ`
  if [ $(($NOWSECOND - $VOICEREQ_STAMP)) -lt $INTERVAL ];then
    VOICE=`echo -en $tVOICEREQ |awk '{gsub("@","",$0);print}'`
    cat >$CMD<<END
#!/bin/bash
echo -en $VOICE |$OPENJTALK -r $VOICE_PITCH -x /var/lib/mecab/dic/open-jtalk/naist-jdic -m /usr/share/hts-voice/mei/mei_normal.htsvoice -ow /dev/stdout |aplay -
END
  fi
fi
